<div class="admin-dashboard">
  <h2>ðŸ”§ Admin Monitoring Dashboard</h2>

  <!-- Connection Change Notifications -->
  <div class="notifications-container" *ngIf="connectionChangeNotifications.length > 0">
    <div
      class="notification"
      *ngFor="let notification of connectionChangeNotifications"
      [class.notification-enter]="true"
    >
      <div class="notification-icon">CHANGE</div>
      <div class="notification-content">
        <strong>{{ notification.serviceName }}</strong> connection method changed:
        <span class="method-change">
          <span class="method-badge method-from">{{ getConnectionMethodLabel(notification.from) }}</span>
          <span class="arrow">â†’</span>
          <span class="method-badge method-to">{{ getConnectionMethodLabel(notification.to) }}</span>
        </span>
        <div class="notification-details">
          <span class="notification-time">{{ notification.timestamp | date:'HH:mm:ss' }}</span>
          <span class="notification-message">Check service status panel for details</span>
        </div>
      </div>
      <button class="notification-dismiss" (click)="dismissNotification(notification.id)">Ã—</button>
    </div>
  </div>

  <!-- Service Status Boxes -->
  <div class="services-panel">
      <h3>Service Status</h3>

      <div class="service-boxes">
        <!-- Frontend Service -->
        <div class="service-box" [class.service-local]="frontendLocation === 'local'" [class.service-remote]="frontendLocation === 'cloud'">
          <div class="service-box-header">
            <h4>Frontend</h4>
            <span class="service-status-badge status-running">Running</span>
          </div>
          <div class="service-box-content">
            <div class="service-location">
              <strong>Location:</strong>
              <span class="location-badge" [class.location-local]="frontendLocation === 'local'" [class.location-cloud]="frontendLocation === 'cloud'">
                {{ frontendLocation === 'local' ? 'Local' : 'K8s' }}
              </span>
            </div>
            <div class="service-description">
              {{ getLocationDescription(frontendLocation, 'frontend') }}
            </div>
          </div>
        </div>

        <!-- Backend Service -->
        <div class="service-box"
             [class.service-local]="services['backend'].location === 'local'"
             [class.service-remote]="services['backend'].location === 'cloud'"
             [class.connection-changed]="services['backend'].connectionMethodChanged">
          <div class="service-box-header">
            <h4>Backend</h4>
            <span class="service-status-badge"
                  [class.status-healthy]="services['backend'].enabled && services['backend'].healthy"
                  [class.status-unhealthy]="services['backend'].enabled && !services['backend'].healthy"
                  [class.status-disconnected]="!services['backend'].enabled">
              {{ getServiceStatusLabel(services['backend']) }}
            </span>
          </div>
          <div class="service-box-content">
            <div class="service-location">
              <strong>Location:</strong>
              <span class="location-badge"
                    [class.location-local]="services['backend'].location === 'local'"
                    [class.location-cloud]="services['backend'].location === 'cloud'">
                {{ services['backend'].location === 'local' ? 'Local' : 'K8s' }}
              </span>
            </div>
            <div class="service-connection">
              <strong>Connection:</strong>
              <span class="connection-method-badge"
                    [class.method-changed]="services['backend'].connectionMethodChanged"
                    [style.background]="getServiceColor(services['backend'])">
                {{ getConnectionMethodIcon(services['backend'].connectionMethod) }}
                {{ getConnectionMethodLabel(services['backend'].connectionMethod) }}
                <span *ngIf="services['backend'].connectionMethodChanged" class="change-badge">CHANGED</span>
              </span>
            </div>
            <div class="service-description">
              {{ getLocationDescription(services['backend'].location, 'backend') }}
            </div>
          </div>
        </div>

        <!-- Payment Service -->
        <div class="service-box service-remote">
          <div class="service-box-header">
            <h4>Payment Service</h4>
            <span class="service-status-badge"
                  [class.status-healthy]="services['payment-service'].enabled && services['payment-service'].healthy"
                  [class.status-unhealthy]="services['payment-service'].enabled && !services['payment-service'].healthy"
                  [class.status-disconnected]="!services['payment-service'].enabled">
              {{ getServiceStatusLabel(services['payment-service']) }}
            </span>
          </div>
          <div class="service-box-content">
            <div class="service-location">
              <strong>Location:</strong>
              <span class="location-badge location-cloud">K8s</span>
            </div>
            <div class="service-connection">
              <strong>Connection:</strong>
              <span class="connection-method-badge" [style.background]="getServiceColor(services['payment-service'])">
                {{ getConnectionMethodIcon(services['payment-service'].connectionMethod) }}
                {{ getConnectionMethodLabel(services['payment-service'].connectionMethod) }}
              </span>
            </div>
            <div class="service-description">
              External service - always runs in Kubernetes
            </div>
          </div>
        </div>

        <!-- MongoDB Service -->
        <div class="service-box service-remote">
          <div class="service-box-header">
            <h4>MongoDB</h4>
            <span class="service-status-badge status-running">Running</span>
          </div>
          <div class="service-box-content">
            <div class="service-location">
              <strong>Location:</strong>
              <span class="location-badge location-cloud">K8s</span>
            </div>
            <div class="service-description">
              Database - always runs in Kubernetes
            </div>
          </div>
        </div>
      </div>

      <div class="connection-methods-info">
        <h4>Connection Methods:</h4>
        <ul>
          <li><strong>Direct:</strong> Direct cluster connection</li>
          <li><strong>Port Forward:</strong> Local access to K8s service</li>
          <li><strong>Ngrok:</strong> Public HTTPS tunnel for webhooks</li>
          <li><strong>Telepresence:</strong> Local debugging with cluster access</li>
          <li><strong>Waiting for Status:</strong> Backend hasn't reported connection method yet</li>
          <li><strong>Socket Not Connected:</strong> WebSocket connection not established</li>
        </ul>
        <p class="info-note"><strong>Note:</strong> Updates work via Socket.IO even when services are on K8s. Connection method changes are shown with notifications.</p>
      </div>

      <!-- Configuration -->
      <div class="control-panel">
        <h3>Configuration</h3>

        <div class="control-group">
          <label class="toggle-label">
            <input
              type="checkbox"
              [checked]="adminConfig.simulatePaymentError"
              (change)="togglePaymentError()"
            />
            <span>Simulate Payment Error</span>
          </label>
        </div>

        <div class="control-group">
          <label>Payment Delay (ms):</label>
          <input
            type="range"
            min="500"
            max="5000"
            step="500"
            [value]="adminConfig.paymentDelayMs"
            (input)="updatePaymentDelay($event)"
          />
          <span class="value-display">{{ adminConfig.paymentDelayMs }}ms</span>
        </div>

        <div class="service-status-list">
          <!-- Frontend Status -->
          <div class="status-item">
            <div
              class="status-indicator"
              [style.background]="'#4caf50'"
            ></div>
            <div class="status-info">
              <strong>Frontend</strong>
              <span>Running</span>
              <div class="connection-method-display">
                <span class="location-badge" [class.location-local]="frontendLocation === 'local'" [class.location-cloud]="frontendLocation === 'cloud'">
                  {{ getLocationLabel(frontendLocation) }}
                </span>
                <span class="location-description">
                  {{ getLocationDescription(frontendLocation, 'frontend') }}
                </span>
              </div>
            </div>
          </div>

          <!-- Backend Status -->
          <div
            class="status-item"
            [class.connection-changed]="services['backend'].connectionMethodChanged"
          >
            <div
              class="status-indicator"
              [style.background]="services['backend'].enabled ? (services['backend'].healthy ? '#4caf50' : '#f44336') : '#999'"
              [class.indicator-pulse]="services['backend'].connectionMethodChanged"
            ></div>
            <div class="status-info">
              <strong>Backend</strong>
              <span>{{ getServiceStatusLabel(services['backend']) }}</span>
              <div class="connection-method-display">
                <span class="location-badge" [class.location-local]="services['backend'].location === 'local'" [class.location-cloud]="services['backend'].location === 'cloud'">
                  {{ getLocationLabel(services['backend'].location) }}
                </span>
                <span
                  class="connection-method-badge"
                  [class.method-changed]="services['backend'].connectionMethodChanged"
                  [style.background]="getServiceColor(services['backend'])"
                >
                  {{ getConnectionMethodIcon(services['backend'].connectionMethod) }}
                  {{ getConnectionMethodLabel(services['backend'].connectionMethod) }}
                  <span *ngIf="services['backend'].connectionMethodChanged" class="change-badge">CHANGED</span>
                </span>
                <span class="location-description">
                  {{ getLocationDescription(services['backend'].location, 'backend') }}
                </span>
              </div>
            </div>
          </div>

          <!-- Payment Service Status -->
          <div class="status-item">
            <div
              class="status-indicator"
              [style.background]="services['payment-service'].enabled ? (services['payment-service'].healthy ? '#4caf50' : '#f44336') : '#999'"
            ></div>
            <div class="status-info">
              <strong>Payment Service</strong>
              <span>{{ getServiceStatusLabel(services['payment-service']) }}</span>
              <div class="connection-method-display">
                <span class="location-badge location-cloud">K8s</span>
                <span class="location-description">
                  External service - always runs in Kubernetes
                </span>
              </div>
            </div>
          </div>

          <!-- MongoDB Status -->
          <div class="status-item">
            <div
              class="status-indicator"
              [style.background]="'#4caf50'"
            ></div>
            <div class="status-info">
              <strong>MongoDB</strong>
              <span>Running</span>
              <div class="connection-method-display">
                <span class="location-badge location-cloud">K8s</span>
                <span class="location-description">
                  Database - always runs in Kubernetes
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Request Logs -->
      <div class="logs-panel">
        <h3>Request Logs</h3>
        <div class="logs-container">
          <div class="log-entry" *ngFor="let log of requestLogs">
            <div class="log-header">
              <span class="log-method" [class.error]="log.status && log.status >= 400">{{ log.method }}</span>
              <span class="log-path">{{ log.path }}</span>
              <span class="log-status" [class.error]="log.status && log.status >= 400">
                {{ log.status || 'pending' }}
              </span>
            </div>
            <div class="log-flow">
              <span class="flow-source">{{ log.source }}</span>
              <span class="flow-arrow">â†’</span>
              <span class="flow-destination">{{ log.destination }}</span>
              <span class="log-duration" *ngIf="log.duration">{{ log.duration }}ms</span>
            </div>
            <div class="log-timestamp">{{ log.timestamp | date:'HH:mm:ss.SSS' }}</div>
          </div>
        </div>
      </div>
    </div>
</div>
